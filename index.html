<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#007A87">
<title>PG Home</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/styles.css?v=4">
</head>
<body>

<!-- ‚ïê‚ïê LOGIN ‚ïê‚ïê -->
<div id="login-screen" class="screen">
  <div class="ll"><div class="lb">üé£</div>PG HOME</div>
  <div class="ls">¬øQui√©n eres?</div>
  <div class="ucards">
    <div class="ucard adm" id="lc-admin">
      <div class="ucav">ADM</div>
      <div><div class="ucnm">Administrador</div><div class="ucrl">Acceso completo ¬∑ PIN requerido</div></div>
      <span style="color:var(--dim);font-size:1.1rem;margin-left:auto">‚Ä∫</span>
    </div>
    <div class="ucard alb" id="lc-alba">
      <div class="ucav">ALB</div>
      <div><div class="ucnm">Alba</div><div class="ucrl">Mis tareas y puntos ¬∑ PIN requerido</div></div>
      <span style="color:var(--dim);font-size:1.1rem;margin-left:auto">‚Ä∫</span>
    </div>
    <div class="ucard sof" id="lc-sofia">
      <div class="ucav">SOF</div>
      <div><div class="ucnm">Sof√≠a</div><div class="ucrl">Mis tareas y puntos ¬∑ PIN requerido</div></div>
      <span style="color:var(--dim);font-size:1.1rem;margin-left:auto">‚Ä∫</span>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê PIN ‚ïê‚ïê -->
<div id="pin-screen" class="screen hidden">
  <div class="pf" id="pin-who-lbl">ACCESO</div>
  <div class="pt">// INTRODUCE TU PIN</div>
  <div class="pin-dots" id="pin-dots">
    <div class="pd" id="pd0"></div><div class="pd" id="pd1"></div>
    <div class="pd" id="pd2"></div><div class="pd" id="pd3"></div>
  </div>
  <div class="pin-kp">
    <button class="pk" data-d="1">1</button><button class="pk" data-d="2">2</button><button class="pk" data-d="3">3</button>
    <button class="pk" data-d="4">4</button><button class="pk" data-d="5">5</button><button class="pk" data-d="6">6</button>
    <button class="pk" data-d="7">7</button><button class="pk" data-d="8">8</button><button class="pk" data-d="9">9</button>
    <div></div><button class="pk" data-d="0">0</button><button class="pk" id="pk-del">‚å´</button>
  </div>
  <div class="pin-err" id="pin-err"></div>
  <div class="pin-back" id="pin-back">‚Üê Volver</div>
</div>

<!-- ‚ïê‚ïê APP ‚ïê‚ïê -->
<div id="loading-overlay" style="display:none;position:fixed;inset:0;background:rgba(244,243,239,.92);z-index:9999;flex-direction:column;align-items:center;justify-content:center;gap:14px;">
  <div style="font-size:2rem;animation:spin 1s linear infinite">üé£</div>
  <div style="font-family:'Space Mono',monospace;font-size:.8rem;color:var(--teal);font-weight:700;letter-spacing:.06em">CARGANDO...</div>
</div>
<div id="app" style="display:none">
  <div class="topbar">
    <div class="logo"><div class="logo-box">üé£</div>PG HOME</div>
    <div id="desknav"></div>
    <div class="topbar-r">
      <div class="who-badge" id="who-badge"></div>
      <div class="logout-btn" id="logout-btn">Salir</div>
    </div>
  </div>
  <div class="bnav" id="mobnav"></div>
  <div class="toast" id="toast"></div>

  <!-- ‚ïê‚ïê Dashboard ‚ïê‚ïê -->
  <div class="view" id="view-dashboard">
    <div class="sh" style="margin-top:4px;margin-bottom:14px">
      <span class="today-lbl" id="today-lbl"></span>
      <button class="btn btn-t btn-sm" id="btn-new-task">+ Tarea</button>
    </div>
    <div class="stats-grid">
      <div class="scard c"><div class="slbl">Tareas hoy</div><div class="sval" id="st-total">0</div><div class="ssub">activas</div></div>
      <div class="scard g"><div class="slbl">Completadas</div><div class="sval" id="st-done">0</div><div class="ssub">aprobadas</div></div>
      <div class="scard a"><div class="slbl">Pts totales</div><div class="sval" id="st-pts">0</div><div class="ssub">acumulados</div></div>
      <div class="scard p"><div class="slbl">Propina</div><div class="sval" id="st-money">‚Ç¨0</div><div class="ssub">disponible</div></div>
    </div>
    <div class="sh"><div class="st">Perfiles</div></div>
    <div class="prof-grid">
      <div class="pcard a" id="pcard-alba">
        <div class="pav">ALB</div><div class="pnm">Alba</div>
        <div class="ppts" id="da-pts">0 pts</div>
        <div class="pbar-bg"><div class="pbar" id="da-bar" style="width:0%"></div></div>
        <div class="pmoney" id="da-money"></div>
      </div>
      <div class="pcard s" id="pcard-sofia">
        <div class="pav">SOF</div><div class="pnm">Sof√≠a</div>
        <div class="ppts" id="ds-pts">0 pts</div>
        <div class="pbar-bg"><div class="pbar" id="ds-bar" style="width:0%"></div></div>
        <div class="pmoney" id="ds-money"></div>
      </div>
    </div>
    <div class="sh">
      <div class="st">Tareas de hoy</div>
      <span class="badge badge-p" id="dash-badge" style="display:none"></span>
    </div>
    <div class="tlist" id="tlist-dash"></div>
    <div class="sh" style="margin-top:18px"><div class="st">Peri√≥dicas programadas</div></div>
    <div class="tlist" id="tlist-upcoming"></div>
  </div>

  <!-- ‚ïê‚ïê Alba ‚ïê‚ïê -->
  <div class="view" id="view-alba">
    <div class="hdr at" style="margin-top:4px">
      <div class="hdr-greet">Panel de</div><div class="hdr-name">Alba</div>
      <div style="display:flex;align-items:baseline;gap:6px"><div class="hdr-pts" id="va-pts">0</div><div class="hdr-ptslbl">puntos</div></div>
      <div class="hdr-money">Propina disponible: <strong id="va-money">‚Ç¨0.00</strong></div>
    </div>
    <div class="propcard">
      <div class="st">Pagar propina</div>
      <div class="prop-row">
        <input class="fc" id="pa-input" type="number" min="1" placeholder="Puntos a canjear" style="flex:1">
        <button class="btn btn-a btn-sm" id="pa-btn">Pagar ‚Üí</button>
      </div>
      <div class="prop-eur" id="pa-eur"></div>
    </div>
    <div class="progcard">
      <div class="sh" style="margin-bottom:10px">
        <div class="st">Objetivos</div>
        <button class="btn btn-g btn-sm" data-openrew="alba">+ Objetivo</button>
      </div>
      <div id="rew-alba"></div>
    </div>
    <div class="sh">
      <div class="st">Sus tareas de hoy</div>
      <span class="badge badge-p" id="va-badge" style="display:none"></span>
    </div>
    <div class="tlist" id="tlist-alba"></div>
  </div>

  <!-- ‚ïê‚ïê Sof√≠a ‚ïê‚ïê -->
  <div class="view" id="view-sofia">
    <div class="hdr st" style="margin-top:4px">
      <div class="hdr-greet">Panel de</div><div class="hdr-name">Sof√≠a</div>
      <div style="display:flex;align-items:baseline;gap:6px"><div class="hdr-pts" id="vs-pts">0</div><div class="hdr-ptslbl">puntos</div></div>
      <div class="hdr-money">Propina disponible: <strong id="vs-money">‚Ç¨0.00</strong></div>
    </div>
    <div class="propcard">
      <div class="st">Pagar propina</div>
      <div class="prop-row">
        <input class="fc" id="ps-input" type="number" min="1" placeholder="Puntos a canjear" style="flex:1">
        <button class="btn btn-a btn-sm" id="ps-btn">Pagar ‚Üí</button>
      </div>
      <div class="prop-eur" id="ps-eur"></div>
    </div>
    <div class="progcard">
      <div class="sh" style="margin-bottom:10px">
        <div class="st">Objetivos</div>
        <button class="btn btn-g btn-sm" data-openrew="sofia">+ Objetivo</button>
      </div>
      <div id="rew-sofia"></div>
    </div>
    <div class="sh">
      <div class="st">Sus tareas de hoy</div>
      <span class="badge badge-p" id="vs-badge" style="display:none"></span>
    </div>
    <div class="tlist" id="tlist-sofia"></div>
  </div>

  <!-- ‚ïê‚ïê Historial ‚ïê‚ïê -->
  <div class="view" id="view-historial">
    <div class="sh" style="margin-top:4px;margin-bottom:14px"><div class="st">Calendario hist√≥rico</div></div>
    <div class="calcard">
      <div class="cal-nav">
        <button class="calnbtn" id="cal-prev">‚Äπ</button>
        <div class="cal-month" id="cal-month-lbl"></div>
        <button class="calnbtn" id="cal-next">‚Ä∫</button>
      </div>
      <div class="cal-grid" id="cal-grid"></div>
      <div id="cal-detail"></div>
    </div>
    <div class="sh"><div class="st">Pagos de propina</div></div>
    <div id="pays-list"></div>
  </div>

  <!-- ‚ïê‚ïê Config ‚ïê‚ïê -->
  <div class="view" id="view-config">
    <div style="font-family:'Space Mono',monospace;font-size:.9rem;font-weight:700;color:var(--teal);margin-bottom:14px;margin-top:4px">// CONFIGURACI√ìN</div>
    <div class="cfgblock">
      <div class="cfgtit">Sistema de puntos</div>
      <div class="cfgrow">
        <span>Puntos equivalentes a ‚Ç¨1</span>
        <input class="cfginp" id="cfg-ppe" type="number" value="100" min="1">
      </div>
    </div>
    <div class="cfgblock">
      <div class="cfgtit">PINs de acceso</div>
      <div class="cfgrow">
        <span>PIN Administrador</span>
        <div style="display:flex;gap:6px;align-items:center">
          <input class="cfginp pw" id="cfg-pin-admin" type="password" value="1234" maxlength="4" placeholder="¬∑¬∑¬∑¬∑">
          <button class="btn btn-g btn-sm" style="padding:5px 9px" id="vis-admin">üëÅ</button>
        </div>
      </div>
      <div class="cfgrow">
        <span style="display:flex;align-items:center;gap:7px">
          <span style="background:var(--fuchsiaL);color:var(--fuchsia);border:1px solid rgba(194,0,117,.2);border-radius:4px;padding:1px 6px;font-size:.65rem;font-weight:700">ALB</span>
          PIN Alba
        </span>
        <div style="display:flex;gap:6px;align-items:center">
          <input class="cfginp pw" id="cfg-pin-alba" type="password" value="1111" maxlength="4" placeholder="¬∑¬∑¬∑¬∑">
          <button class="btn btn-g btn-sm" style="padding:5px 9px" id="vis-alba">üëÅ</button>
        </div>
      </div>
      <div class="cfgrow">
        <span style="display:flex;align-items:center;gap:7px">
          <span style="background:var(--violetL);color:var(--violet);border:1px solid rgba(106,63,200,.2);border-radius:4px;padding:1px 6px;font-size:.65rem;font-weight:700">SOF</span>
          PIN Sof√≠a
        </span>
        <div style="display:flex;gap:6px;align-items:center">
          <input class="cfginp pw" id="cfg-pin-sofia" type="password" value="2222" maxlength="4" placeholder="¬∑¬∑¬∑¬∑">
          <button class="btn btn-g btn-sm" style="padding:5px 9px" id="vis-sofia">üëÅ</button>
        </div>
      </div>
      <div style="padding:10px 15px;border-top:1px solid var(--border)">
        <button class="btn btn-s btn-w btn-sm" id="save-pins-btn">Guardar PINs</button>
      </div>
    </div>
    <div class="cfgblock">
      <div class="cfgtit">Cat√°logo de tareas</div>
      <div id="cfg-tasks"></div>
      <div style="padding:10px 14px;border-top:1px solid var(--border);display:flex;gap:7px;align-items:center">
        <input class="fc" id="cfg-emoji" placeholder="üè†" style="width:46px;text-align:center;font-size:1rem;flex-shrink:0">
        <input class="fc" id="cfg-tname" placeholder="Nueva tarea...">
        <button class="btn btn-t btn-sm" id="cfg-add-task">+</button>
      </div>
    </div>
    <div class="cfgblock">
      <div class="cfgtit">Notificaciones</div>
      <div class="cfgrow"><span>Recordatorio ma√±anero</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
      <div class="cfgrow"><span>Aviso tareas sin hacer</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê Hija: Inicio ‚ïê‚ïê -->
  <div class="view" id="view-hija-inicio">
    <div class="hdr" id="hija-hdr" style="margin-top:4px">
      <div class="hdr-greet">Hola,</div>
      <div class="hdr-name" id="hija-name"></div>
      <div style="display:flex;align-items:baseline;gap:6px"><div class="hdr-pts" id="hija-pts">0</div><div class="hdr-ptslbl">puntos</div></div>
      <div class="hdr-money">Propina: <strong id="hija-money">‚Ç¨0.00</strong></div>
    </div>
    <div class="stats-grid">
      <div class="scard c"><div class="slbl">Pendientes</div><div class="sval" id="hija-pend">0</div><div class="ssub">hoy</div></div>
      <div class="scard g"><div class="slbl">Hechas</div><div class="sval" id="hija-done">0</div><div class="ssub">aprobadas</div></div>
    </div>
    <div class="sh"><div class="st">Mis tareas de hoy</div></div>
    <div class="tlist" id="tlist-hija1"></div>
  </div>

  <!-- ‚ïê‚ïê Hija: Tareas ‚ïê‚ïê -->
  <div class="view" id="view-hija-tareas">
    <div class="sh" style="margin-top:4px;margin-bottom:14px"><div class="st">Todas mis tareas</div></div>
    <div class="tlist" id="tlist-hija2"></div>
  </div>

  <!-- ‚ïê‚ïê Hija: Metas ‚ïê‚ïê -->
  <div class="view" id="view-hija-metas">
    <div class="sh" style="margin-top:4px;margin-bottom:14px"><div class="st">Mis objetivos</div></div>
    <div class="progcard"><div id="hija-rewards"></div></div>
  </div>
</div>

<!-- ‚ïê‚ïê Modal: Nueva tarea ‚ïê‚ïê -->
<div class="mov" id="modal-task">
  <div class="modal">
    <div class="mdrag"></div>
    <div class="mtitle">// NUEVA TAREA</div>
    <div class="fgrp">
      <label class="flbl">Tarea del cat√°logo</label>
      <select class="fc" id="mt-sel"><option value="">‚Äî Selecciona ‚Äî</option></select>
    </div>
    <div class="fgrp">
      <label class="flbl">Periodicidad</label>
      <div class="freq-row" id="freq-row">
        <div class="fqopt on" data-fq="unica">√önica</div>
        <div class="fqopt" data-fq="diaria">Diaria</div>
        <div class="fqopt" data-fq="semanal">Semanal</div>
      </div>
    </div>
    <div class="fgrp">
      <label class="flbl" id="mt-date-lbl">Fecha</label>
      <input class="fc" id="mt-date" type="date">
    </div>
    <div class="fgrp hidden" id="mt-wd-grp">
      <label class="flbl">D√≠a de la semana</label>
      <select class="fc" id="mt-wd">
        <option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option>
        <option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option><option value="0">Domingo</option>
      </select>
    </div>
    <div class="frow">
      <div class="fgrp"><label class="flbl">Puntos</label><input class="fc" id="mt-pts" type="number" value="20" min="5" max="200" step="5"></div>
      <div class="fgrp"><label class="flbl">Para</label>
        <select class="fc" id="mt-who">
          <option value="Alba">Alba</option><option value="Sof√≠a">Sof√≠a</option><option value="Ambas">Ambas</option>
        </select>
      </div>
    </div>
    <button class="btn btn-s btn-w" id="mt-submit">Crear tarea ‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê Modal: Objetivos ‚ïê‚ïê -->
<div class="mov" id="modal-reward">
  <div class="modal">
    <div class="mdrag"></div>
    <div class="mtitle" id="mr-title">// OBJETIVOS</div>
    <div id="mr-list" style="margin-bottom:14px"></div>
    <label class="flbl">A√±adir objetivo</label>
    <div style="display:flex;gap:7px;margin:6px 0 10px">
      <input class="fc" id="mr-emoji" placeholder="üéØ" style="width:44px;text-align:center;flex-shrink:0">
      <input class="fc" id="mr-name" placeholder="Nombre...">
      <input class="fc" id="mr-pts" type="number" placeholder="pts" min="10" step="10" style="width:70px;flex-shrink:0">
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-t" style="flex:1" id="mr-add">+ A√±adir</button>
      <button class="btn btn-s" style="flex:1" id="mr-close">Guardar</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/app.js?v=4"></script>
</body>
</html>
